<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromeæ‹¡å¼µæ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        .log-output {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .instruction {
            background: #e7f3ff;
            padding: 10px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .folder-structure {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Chromeæ‹¡å¼µæ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="instruction">
        <h3>ğŸ“‹ ãƒ‡ãƒãƒƒã‚°æ‰‹é †</h3>
        <ol>
            <li>Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã</li>
            <li>é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« (F12) ã‚’é–‹ã</li>
            <li>Consoleã‚¿ãƒ–ã‚’é¸æŠ</li>
            <li>ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚’ç¢ºèª</li>
            <li>ä¸‹è¨˜ã®ãƒœã‚¿ãƒ³ã§ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã§ãã¾ã™</li>
        </ol>
    </div>

    <div class="debug-section">
        <h3>ğŸ” ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰</h3>
        <button onclick="clearConsole()">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢</button>
        <button onclick="analyzeStructure()">HTMLæ§‹é€ è§£æ</button>
        <button onclick="listEventListeners()">ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç¢ºèª</button>
        <button onclick="testFolderClicks()">ãƒ•ã‚©ãƒ«ãƒ€ã‚¯ãƒªãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="debug-section">
        <h3>ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
        <div class="log-output">
DEBUG: setupFolderClickHandler called {
  containerId: "bookmarkContainer",
  containerClassName: "",
  allBookmarksCount: X,
  folderHeaderCount: X
}

// ãƒ•ã‚©ãƒ«ãƒ€ã‚¯ãƒªãƒƒã‚¯æ™‚:
DEBUG: Click event detected: {
  targetTag: "H2" ã¾ãŸã¯ "SPAN",
  targetClass: "folder-title" ã¾ãŸã¯ "expand-icon",
  folderHeader: "found",
  hasSubfolders: true
}

DEBUG: Folder header clicked

DEBUG: Found folder: {
  title: "ãƒ•ã‚©ãƒ«ãƒ€å",
  id: "XXX",
  subfolderCount: X,
  hasSubfolders: true,
  currentExpanded: false/true
}

DEBUG: Toggling folder state: {
  before: false,
  after: true,
  hasSubfolders: true
}

DEBUG: UI update completed for folder: "ãƒ•ã‚©ãƒ«ãƒ€å"
        </div>
    </div>

    <div class="debug-section">
        <h3>âš ï¸ å•é¡Œè¨ºæ–­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
        <div id="diagnostics">
            <div class="instruction">
                <h4>ãƒã‚§ãƒƒã‚¯é …ç›®:</h4>
                <ul>
                    <li>âœ… `setupFolderClickHandler called` ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>âœ… ãƒ•ã‚©ãƒ«ãƒ€ã‚¯ãƒªãƒƒã‚¯æ™‚ã« `Click event detected` ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>âœ… `folderHeader: "found"` ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>âœ… `hasSubfolders: true` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚ã‚Šã®å ´åˆï¼‰</li>
                    <li>âœ… `Found folder` ã§æ­£ã—ã„ãƒ•ã‚©ãƒ«ãƒ€æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>âœ… `Toggling folder state` ã§stateã®å¤‰æ›´ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>âœ… `UI update completed` ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h3>ğŸ› ï¸ HTMLæ§‹é€ åˆ†æçµæœ</h3>
        <div id="structure-analysis" class="folder-structure">
            ã“ã“ã«æ§‹é€ è§£æã®çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>

    <script>
        function clearConsole() {
            console.clear();
            console.log('ğŸ§¹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        function analyzeStructure() {
            console.log('ğŸ” HTMLæ§‹é€ ã‚’è§£æä¸­...');
            
            // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚³ãƒ³ãƒ†ãƒŠã‚’å–å¾—
            const container = document.getElementById('bookmarkContainer');
            if (!container) {
                console.error('âŒ bookmarkContainer ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            // ãƒ•ã‚©ãƒ«ãƒ€ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ•°
            const folderHeaders = container.querySelectorAll('.folder-header');
            console.log(`ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ãƒ˜ãƒƒãƒ€ãƒ¼æ•°: ${folderHeaders.length}`);

            // ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®æ•°
            const hasSubfolders = container.querySelectorAll('.folder-header.has-subfolders');
            console.log(`ğŸ“‚ ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚ã‚Šãƒ•ã‚©ãƒ«ãƒ€æ•°: ${hasSubfolders.length}`);

            // ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚³ãƒ³ãƒ†ãƒŠã®æ•°
            const subfolderContainers = container.querySelectorAll('.subfolders-container');
            console.log(`ğŸ“¦ ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚³ãƒ³ãƒ†ãƒŠæ•°: ${subfolderContainers.length}`);

            // å„ãƒ•ã‚©ãƒ«ãƒ€ã®è©³ç´°æƒ…å ±
            folderHeaders.forEach((header, index) => {
                const folder = header.closest('.bookmark-folder');
                const folderId = folder?.getAttribute('data-folder-id');
                const title = header.querySelector('.folder-title')?.textContent;
                const hasSubfoldersClass = header.classList.contains('has-subfolders');
                const expandIcon = header.querySelector('.expand-icon');
                
                console.log(`ãƒ•ã‚©ãƒ«ãƒ€ ${index + 1}:`, {
                    title,
                    folderId,
                    hasSubfolders: hasSubfoldersClass,
                    hasExpandIcon: !!expandIcon,
                    expandIconText: expandIcon?.textContent
                });
            });

            // çµæœã‚’HTMLã«ã‚‚è¡¨ç¤º
            const analysisDiv = document.getElementById('structure-analysis');
            if (analysisDiv) {
                analysisDiv.innerHTML = `
ãƒ•ã‚©ãƒ«ãƒ€ãƒ˜ãƒƒãƒ€ãƒ¼æ•°: ${folderHeaders.length}
ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚ã‚Šãƒ•ã‚©ãƒ«ãƒ€æ•°: ${hasSubfolders.length}
ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚³ãƒ³ãƒ†ãƒŠæ•°: ${subfolderContainers.length}

è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                `;
            }
        }

        function listEventListeners() {
            console.log('ğŸ§ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç¢ºèªä¸­...');
            
            const container = document.getElementById('bookmarkContainer');
            if (!container) {
                console.error('âŒ bookmarkContainer ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒã‚ã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            console.log('ğŸ“‹ ã‚³ãƒ³ãƒ†ãƒŠã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ:');
            console.log('- click ã‚¤ãƒ™ãƒ³ãƒˆ:', getEventListeners(container)?.click?.length || 0);
            
            // æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
            console.log('ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ...');
        }

        function testFolderClicks() {
            console.log('ğŸ§ª ãƒ•ã‚©ãƒ«ãƒ€ã‚¯ãƒªãƒƒã‚¯ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            const container = document.getElementById('bookmarkContainer');
            if (!container) {
                console.error('âŒ bookmarkContainer ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            const folderHeaders = container.querySelectorAll('.folder-header.has-subfolders');
            
            if (folderHeaders.length === 0) {
                console.log('âš ï¸ ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒã¤ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            console.log(`ğŸ“‚ ${folderHeaders.length}å€‹ã®ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
            
            folderHeaders.forEach((header, index) => {
                const title = header.querySelector('.folder-title')?.textContent;
                console.log(`ãƒ†ã‚¹ãƒˆ ${index + 1}: "${title}" ã‚’ã‚¯ãƒªãƒƒã‚¯`);
                
                // ãƒ—ãƒ­ã‚°ãƒ©ãƒ çš„ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
                setTimeout(() => {
                    header.click();
                }, (index + 1) * 1000); // 1ç§’é–“éš”ã§ã‚¯ãƒªãƒƒã‚¯
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        console.log('ğŸš€ Chromeæ‹¡å¼µæ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
        console.log('ğŸ’¡ analyzeStructure() é–¢æ•°ã§HTMLæ§‹é€ ã‚’åˆ†æã§ãã¾ã™');
    </script>
</body>
</html>
